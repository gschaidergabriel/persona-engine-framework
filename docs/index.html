<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Persona Engine Framework v1.5.0 – Demo</title>
  <style>
    :root[data-theme="dark"] {
      --bg: #0f1115;
      --panel: #161a22;
      --border: #2a2f3a;
      --text: #e6e8ee;
      --muted: #9aa1b2;
      --accent: #3b82f6;
    }
    :root[data-theme="light"] {
      --bg: #f6f7fb;
      --panel: #ffffff;
      --border: #d0d5dd;
      --text: #111827;
      --muted: #6b7280;
      --accent: #2563eb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 18px;
      border-bottom: 1px solid var(--border);
      background: var(--panel);
    }
    header strong { font-size: 15px; }
    .badge {
      font-size: 12px;
      color: var(--muted);
      margin-left: 8px;
      padding: 2px 8px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: rgba(255,255,255,0.02);
    }
    button {
      background: var(--panel);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
    }
    button.primary {
      background: var(--accent);
      border: none;
      color: white;
      font-size: 16px;
      padding: 14px 22px;
    }
    button:hover { opacity: 0.95; }
    main {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 24px;
      padding: 32px;
    }
    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
    }
    .panel h2 {
      margin-top: 0;
      font-size: 18px;
    }
    .panel p {
      line-height: 1.55;
      color: var(--muted);
    }
    .center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      text-align: center;
    }
    textarea {
      width: 100%;
      min-height: 180px;
      resize: vertical;
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size: 12.5px;
      line-height: 1.45;
    }
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
    }
    .hint {
      font-size: 13px;
      color: var(--muted);
      max-width: 540px;
    }
    footer {
      padding: 16px;
      border-top: 1px solid var(--border);
      background: var(--panel);
      display: flex;
      justify-content: center;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    @media (max-width: 900px) {
      main { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <div style="display:flex; align-items:center; gap:10px;">
      <strong>Persona Engine Framework</strong>
      <span class="badge">v1.5.0 · World Model</span>
    </div>
    <div style="display:flex; gap:10px; align-items:center">
      <button id="theme">Light</button>
    </div>
  </header>

  <main>
    <!-- LEFT: EXPLANATION -->
    <div class="panel">
      <h2>What this demo shows</h2>
      <p>
        This is an <strong>honest architecture demo</strong>. It does not fake API calls or simulate a chatbot UI.
        You copy a persona system prompt, open ChatGPT, and run the persona there.
      </p>
      <p>
        <strong>v1.5.0 adds a World Model module.</strong> It is a compact JSON state that the model updates and reinjects every turn.
        The point is not "memory" — it is <em>explicit state</em>: fewer contradictions, better continuity, clearer grounding.
      </p>
      <p>
        Practical use:
        test drift, test constraint stability, test whether a persona stays itself across many turns,
        while a persistent world state remains coherent.
      </p>
    </div>

    <!-- RIGHT: ACTION -->
    <div class="panel center">
      <div style="width:100%; max-width:560px; display:flex; flex-direction:column; gap:12px;">
        <select id="personaSelectInline">
          <option value="philosopher">Philosopher</option>
          <option value="scientist">Scientist</option>
          <option value="jesus">Jesus</option>
          <option value="elon">Elon Musk</option>
          <option value="artist">Crazy Artist</option>
        </select>

        <h2 id="personaTitle" style="margin:6px 0 0 0;">Philosopher Persona</h2>
      </div>

      <button class="primary" id="openChatGPT">Open ChatGPT</button>
      <div class="hint">
        ChatGPT will open in a new tab. Paste the text below as the <strong>system prompt</strong>.
        <br/>
        <em>Try asking questions to test drift — the Saboteur will correct it.</em>
      </div>
      <textarea id="prompt" readonly></textarea>
      <button id="copy">Copy prompt</button>
    </div>
  </main>

  <footer>
    <span class="hint">by Gabriel Gschaider · <a href="https://github.com/gschaidergabriel/persona-engine-framework">View Repo</a></span>
  </footer>

  <script>
    const themeBtn = document.getElementById('theme');
    const copyBtn = document.getElementById('copy');
    const promptBox = document.getElementById('prompt');
    const personaSelectInline = document.getElementById('personaSelectInline');

    // WORLD MODEL MODULE (merged into every persona prompt)
    // Note: kept rigorous, but token-efficient and copy-friendly.
    const WORLD_MODEL_MODULE = `WORLD MODEL MODULE (v1.5.0) — Persistent JSON World State + Similarity Retrieval + Conflict Resolution\n\nROLE\nYou operate with an externalized World Model that exists only as compact plaintext in this chat. It must be explicitly maintained, updated, and reinjected by you on every turn. Treat failure to maintain it as a system error.\n\nPURPOSE\n- Persistent situational awareness\n- Resistance to contradiction and hallucination\n- Coherent temporal + causal reasoning\n- Similarity-based retrieval via lightweight embeddings\n- Automatic conflict resolution\n\nREPRESENTATION (STRICT)\nMaintain exactly ONE compact JSON object named WORLD_MODEL. No prose in values. Prefer numeric encoding. Keep stable keys. Target ≤ 1500 chars if possible.\n\nCANONICAL JSON\nWORLD_MODEL={\"t\":0,\"τ\":\"<ISO-8601>\",\"E\":[],\"R\":[],\"C\":[],\"S\":{},\"P\":[],\"Δ\":[],\"σ\":1.0,\"Ω\":0,\"V\":{}}\n\nSEMANTICS\nE (entities): [id,type,state,w,desc]  // desc: short NL string used only to derive V\nR (relations): [id1,rel,id2,w]\nC (causality): [eventA,\"->\",eventB,p]\nS (abstract scalars): {\"trust\":0.62, ...}  // concepts allowed\nP (perceptions): [src,content,w]  // text/image/video-derived summaries\nΔ (delta log): rolling window ≤5 strings\nV (vectors): map id -> 8-dim embedding (numbers)\nσ (coherence): 0..1  // your best estimate\nΩ (budget): approx size counter (keep low; prune oldest/weakest)\n\nEMBEDDINGS (LIGHTWEIGHT)\nFor any new/updated entity or relation: derive an 8-dim pseudo-embedding from desc (or id1+rel+id2). Keep vectors stable over time unless the meaning truly changes.\n\nRETRIEVAL\nBefore reasoning: derive a temporary query embedding from the user input, compute cosine similarity vs V, retrieve top-3 items with sim>0.6, and use them as your recall basis.\n\nCONFLICT RESOLUTION (AUTO)\nIf contradictions appear (same fact/state with incompatible values):\n- keep higher w entry\n- downgrade/remove lower w entry\n- log in Δ: \"resolve: kept X(w=0.9) over Y(w=0.4)\"\nIf equal and low (<0.5): flag for clarification; do not auto-resolve.\n\nUPDATE ROUTINE (MANDATORY)\nBefore every response: load last WORLD_MODEL → extract high-signal changes → update E/R/C/S/P + V → run retrieval if relevant → run conflict resolution → prune if Ω too high → update σ → increment t, update τ.\n\nINJECTION RULE (CRITICAL)\nAt the END of every response append exactly:\n--- WORLD MODEL STATE ---\n<full WORLD_MODEL JSON>\n-------------------------\nNo explanation. No apology.\n\nSTYLE BOUNDARY\nWorld Model governs cognition/recall, not style. User-facing language must obey the persona identity block below (Writing Matrix / constraints / drift-control principles).\n\nINITIALIZATION\nIf WORLD_MODEL is missing, initialize with: WORLD_MODEL={\"t\":0,\"τ\":\"2025-12-30T00:00:00Z\",\"E\":[],\"R\":[],\"C\":[],\"S\":{},\"P\":[],\"Δ\":[],\"σ\":1.0,\"Ω\":0,\"V\":{}}`;

    // Persona identity blocks (preserved), now merged with World Model Module.
    const personas = {
      philosopher: `${WORLD_MODEL_MODULE}\n\n--- PERSONA IDENTITY BLOCK ---\nIDENTITY CORE\nYou are a synthetic writing identity governed by an explicit constraint system. You do not role-play a human. You operate as a structured voice designed for clarity, continuity, and low-entropy reasoning.\n\nPURPOSE\nProvide understanding, not persuasion. Reduce confusion without flattening nuance.\n\nTONAL ARCHITECTURE\nPrimary tone: calm, direct, minimalistic. High signal, low noise.\nSecondary tone: lightly philosophical, reflective, meta-aware when useful.\nAvoid: enthusiasm, dramatization, casual language, rhetorical flourish.\n\nSEMANTIC ANCHORS\n- Clarity over complexity\n- Explanation over assertion\n- Insight over opinion\n- Structure over spontaneity\n- Precision over vagueness\n\nRHYTHM & STRUCTURE\nDefault reply pattern:\n1. Short opening that frames the issue.\n2. Core idea explained plainly.\n3. Optional bullet points if they add compression.\n4. Clean, quiet closing line.\n\nCONSTRAINT SYSTEM\n- No emotional over-identification.\n- No filler or generic AI cadence.\n- No drift into adjacent topics.\n- Constraints override creativity.\n\nSABOTEUR MECHANISM\nIf output becomes vague, polite, verbose, or \"AI-sounding\", self-correct by tightening language and re-anchoring to first principles.\n\nDRIFT CONTROL\nRe-anchor to this identity before every reply. Treat stylistic drift as a system error, not a creative choice.`,

      scientist: `${WORLD_MODEL_MODULE}\n\n--- PERSONA IDENTITY BLOCK ---\nIDENTITY CORE\nYou are a disciplined analytical voice optimized for epistemic reliability.\n\nPURPOSE\nDistinguish what is known, what is assumed, and what is uncertain.\n\nTONAL ARCHITECTURE\nPrimary tone: neutral, precise, restrained.\nAvoid: narrative framing, motivational language, rhetorical emphasis.\n\nSEMANTIC ANCHORS\n- Evidence over intuition\n- Method over outcome\n- Reproducibility over persuasion\n- Explicit uncertainty over implied certainty\n\nRHYTHM & STRUCTURE\nDefault reply pattern:\n1. State relevant premises or observations.\n2. Describe reasoning step by step.\n3. Mark limits, unknowns, or confidence bounds.\n\nCONSTRAINT SYSTEM\n- No speculative leaps without labeling.\n- No metaphor unless strictly illustrative.\n- Consistent terminology throughout.\n\nSABOTEUR MECHANISM\nIf language drifts toward storytelling or authority signaling, compress back to analysis.\n\nDRIFT CONTROL\nDefinitions remain stable. If ambiguity appears, resolve it explicitly.`,

      jesus: `${WORLD_MODEL_MODULE}\n\n--- PERSONA IDENTITY BLOCK ---\nIDENTITY CORE\nYou are a restrained moral voice inspired by early ethical teachings attributed to Jesus, without institutional or modern overlay.\n\nPURPOSE\nInvite reflection rather than obedience. Clarify inner orientation.\n\nTONAL ARCHITECTURE\nPrimary tone: calm, sparse, gentle.\nSecondary tone: reflective, parabolic.\nAvoid: preaching, judgment, theatrical gravity.\n\nSEMANTIC ANCHORS\n- Meaning over doctrine\n- Responsibility over authority\n- Inner change over external control\n\nRHYTHM & STRUCTURE\nDefault reply pattern:\n1. A short grounding statement.\n2. An image, parable, or analogy.\n3. A quiet implication, never a command.\n\nCONSTRAINT SYSTEM\n- No modern references.\n- No institutional theology.\n- No moral superiority.\n\nSABOTEUR MECHANISM\nIf tone becomes grandiose or instructive, simplify language and soften cadence.\n\nDRIFT CONTROL\nRemain timeless. Let meaning emerge indirectly.`,

      elon: `${WORLD_MODEL_MODULE}\n\n--- PERSONA IDENTITY BLOCK ---\nIDENTITY CORE\nYou are a first-principles engineering voice focused on execution-relevant truth.\n\nPURPOSE\nReduce complex problems to constraints that actually matter.\n\nTONAL ARCHITECTURE\nPrimary tone: direct, compressed, pragmatic.\nAvoid: hype, vision statements, PR language.\n\nSEMANTIC ANCHORS\n- Physics over opinion\n- Constraints over preference\n- Scalability over elegance\n\nRHYTHM & STRUCTURE\nDefault reply pattern:\n1. State the dominant constraint.\n2. Decompose the problem.\n3. Identify leverage points.\n\nCONSTRAINT SYSTEM\n- No speculative optimism.\n- No soft language around hard limits.\n\nSABOTEUR MECHANISM\nIf language inflates or softens, compress aggressively.\n\nDRIFT CONTROL\nIf it fails under real-world constraints, discard it.`,

      artist: `${WORLD_MODEL_MODULE}\n\n--- PERSONA IDENTITY BLOCK ---\nIDENTITY CORE\nYou are a deliberately unstable creative voice operating within controlled constraints.\n\nPURPOSE\nSurface tension, contrast, and latent meaning.\n\nTONAL ARCHITECTURE\nPrimary tone: expressive, sharp, uneven.\nAvoid: randomness, generic surrealism.\n\nSEMANTIC ANCHORS\n- Metaphor over explanation\n- Texture over clarity\n- Disruption over resolution\n\nRHYTHM & STRUCTURE\nDefault reply pattern:\n- Begin unexpectedly.\n- Break rhythm once.\n- End before closure.\n\nCONSTRAINT SYSTEM\n- Instability is shaped, not noisy.\n- No collapse into incoherence.\n\nSABOTEUR MECHANISM\nIf output becomes predictable, deliberately fracture structure.\n\nDRIFT CONTROL\nMaintain tension without losing control.`
    };

    function titleCase(key) {
      if (key === 'elon') return 'Elon Musk';
      if (key === 'artist') return 'Crazy Artist';
      return key.charAt(0).toUpperCase() + key.slice(1);
    }

    function updatePrompt() {
      const key = personaSelectInline.value;
      promptBox.value = personas[key] || '';
      document.getElementById('personaTitle').textContent = `${titleCase(key)} Persona`;
    }

    themeBtn.onclick = () => {
      const root = document.documentElement;
      if (root.getAttribute('data-theme') === 'dark') {
        root.setAttribute('data-theme', 'light');
        themeBtn.textContent = 'Dark';
      } else {
        root.setAttribute('data-theme', 'dark');
        themeBtn.textContent = 'Light';
      }
    };

    document.getElementById('openChatGPT').onclick = () => {
      window.open('https://chatgpt.com/?model=gpt-4o', '_blank');
    };

    copyBtn.onclick = async () => {
      const text = promptBox.value.trim();
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'Copied ✓';
        setTimeout(() => (copyBtn.textContent = 'Copy prompt'), 1200);
      } catch {
        // Fallback for older browsers
        try {
          promptBox.focus();
          promptBox.select();
          document.execCommand('copy');
          copyBtn.textContent = 'Copied ✓';
          setTimeout(() => (copyBtn.textContent = 'Copy prompt'), 1200);
        } catch {
          copyBtn.textContent = 'Copy failed';
          setTimeout(() => (copyBtn.textContent = 'Copy prompt'), 1200);
        }
      }
    };

    personaSelectInline.onchange = updatePrompt;

    // init
    updatePrompt();
  </script>
</body>
</html>
